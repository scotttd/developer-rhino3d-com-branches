<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Retrieving Rhino Data from the Clipboard</title>
  <meta name="description" content="Retrieving Rhino Data from the Clipboard">

  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/languages/vbnet.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="developer-rhino3d-com-branches/css/main.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="developer-rhino3d-com-branches/css/bootstrap-override.css">

  <link rel="canonical" href="http://mcneel.github.io/developer-rhino3d-com-branchesdeveloper-rhino3d-com-branches/guides/cpp/retreiving_rhino_data_from_clipboard/">
  <link rel="alternate" type="application/rss+xml" title="Rhino Developer Docs" href="http://mcneel.github.io/developer-rhino3d-com-branchesdeveloper-rhino3d-com-branches/feed.xml" />

  <link rel="shortcut icon" href="http://developer.rhino3d.com/favicon.ico?v=2" />
  <!-- Saving bookmarks to mobile devices -->
  <!-- For non-Retina (@1× display) iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="developer-rhino3d-com-branches/images/apple-touch-icon-precomposed.png"><!-- 57×57px -->
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="developer-rhino3d-com-branches/images/apple-touch-icon-72x72-precomposed.png">
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="developer-rhino3d-com-branches/images/apple-touch-icon-76x76-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="developer-rhino3d-com-branches/images/apple-touch-icon-114x114-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="developer-rhino3d-com-branches/images/apple-touch-icon-120x120-precomposed.png">
  <!-- For iPad with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="developer-rhino3d-com-branches/images/apple-touch-icon-144x144-precomposed.png">
  <!-- For iPad with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="developer-rhino3d-com-branches/images/apple-touch-icon-152x152-precomposed.png">
  <!-- For iPhone 6 Plus with @3× display: -->
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="developer-rhino3d-com-branches/images/apple-touch-icon-180x180-precomposed.png">
  <!-- For Chrome for Android: -->
  <link rel="icon" sizes="192x192" href="images/touch-icon-192x192.png">

</head>


  <body>

    <!-- Google Tag Manager **This belongs right after the <body> tag**-->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MWMDKN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MWMDKN');
    </script>
    <!-- End Google Tag Manager -->


    <div class="container">
      <header class="site-header">


    <a class="site-title" href="developer-rhino3d-com-branches/"><img src="developer-rhino3d-com-branches/images/rhinodevlogo148x128.png" alt="Rhino Developer Docs" height="48" width="56"></a><a class="site-title" href="developer-rhino3d-com-branches/">Rhino Developer Docs</a>

    <nav class="site-nav">
      <img class="menu-icon" src="developer-rhino3d-com-branches/images/gi.svg">
      
      <div class="trigger">
      	<!--<a class="page-link" href="developer-rhino3d-com-branches/">Welcome</a>-->
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
        
          
            
              
                <a class="page-link" href="developer-rhino3d-com-branches/guides/">Guides</a>
              
            
          
        
          
            
              
                <a class="page-link" href="developer-rhino3d-com-branches/api/">API</a>
              
            
          
        
          
            
              
                <a class="page-link" href="developer-rhino3d-com-branches/samples/">Samples</a>
              
            
          
        
          
            
          
        
        <a class="page-link" href="http://discourse.mcneel.com/c/rhino-developer">Forums</a>
        <!-- Google Search Engine -->
        <!-- TODO Move to this site back into the Mcneel search, or use a simple site only search for results -->
        <div id="sitesearch">
            <!-- Google CSE Search Box Begins  -->
            <!-- Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
            <!-- The terms of service are available at https://www.google.com/cse/docs/tos.html -->
            <form id="cref" action="developer-rhino3d-com-branches/search-results.html">
                <input type="hidden" name="cref" value="007988927381198593803:mcq6pshqsn8" />
                <input id="searchtext" type="text" name="q" size="24" value="" placeholder="search" />
                <input class="searchBox" type="submit" name="sa" size="2" value=" " />
            </form>
        <!-- Google CSE Search Box Ends -->
        </div>
        <!--End of Google Search Engine -->
      </div>
    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <div class="container-fluid">

<div class="row-fluid">
    <!--Nav Bar -->
    <nav class="col-xs-0 col-md-3 bs-docs-sidebar">
        <ul id="sidebar" class="nav nav-stacked fixed">

          <li>
            <a href="developer-rhino3d-com-branches/guides/">Guides</a>

            <ul class="nav nav-stacked">

              <li>

                
                  <a href="developer-rhino3d-com-branches/guides/#cpp">C/C++</a>
                
                <ul class="nav nav-stacked">

                  <!-- Find the h1 handle for title -->
                  
                  
                  
                  
                  
                  
                  
                  <li>
                    <a href="#retrieving-rhino-data-from-the-clipboard">Retrieving Rhino Data fro...</a>

                    <ul class="nav nav-stacked">

                      <!-- Find the h2 group and any h3 subgroups -->
                      

                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#overview">Overview</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#sample">Sample</a>

                          

                        </li>
                      

                    </ul>

                  </li>

                </ul>

              </li>

            </ul>

          </li>

        </ul>
    </nav>
    <!--Main Content -->
    <div class="col-xs-12 col-md-9">
      <!--<div class="post">-->

        <article class="post-content">
          <h1 id="retrieving-rhino-data-from-the-clipboard">Retrieving Rhino Data from the Clipboard</h1>

<p>This guide demonstrates how to access Rhino data from the Windows Clipboard using C/C++.</p>

<h2 id="overview">Overview</h2>

<p>Like most Windows applications, Rhino can cut, copy, and paste information to and from the Windows Clipboard.  When Rhino either cuts or copies geometry to the clipboard, it creates a temporary 3DM file that contains the selected geometry.  Rhino then stores the temporary filename in the Clipboard.  When a paste operation is invoked, Rhino determines if the Clipboard contains the name of a temporary Rhino file.  If found, Rhino simply imports the temporary file.</p>

<p>Rhino registers custom Clipboard formats to store the temporary file names: a unique Clipboard format for each Rhino version.</p>

<h2 id="sample">Sample</h2>

<p>The following sample demonstrates how to determine of there is Rhino information in the Windows Clipboard.  If there is Rhino data in the Clipboard, the sample will retrieve the name of the temporary file.  Once this file name is known, you can whatever means necessary to retrieve the data.  For example, if you are using this code from a Rhino plugin, you could script the running of Rhino’s <em>Paste</em> command to insert the geometry into the current document.  If you are in a standalone application, you would use the openNURBS toolkit to read the temporary .3DM file.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">/////////////////////////////////////////////////////////////////////////////
// clipboard.cpp
</span>
<span class="cp">#include "StdAfx.h"
#include &lt;afxole.h&gt; // MFC OLE clipboard support
</span>
<span class="c1">// TODO: Fill this in with your own message printing
</span><span class="k">static</span> <span class="kt">void</span> <span class="nf">myPrintMessage</span><span class="p">(</span> <span class="n">LPCTSTR</span> <span class="n">lpMessage</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">lpMessage</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">lpMessage</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">;</span>
<span class="cp">#ifdef RHINO_SDK_CLASS
</span>  <span class="n">RhinoApp</span><span class="p">().</span><span class="n">Print</span><span class="p">(</span> <span class="n">ON_wString</span><span class="p">(</span><span class="n">lpMessage</span><span class="p">)</span> <span class="p">);</span>
<span class="cp">#else
</span>  <span class="n">MessageBox</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lpMessage</span><span class="p">,</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Clipboard Message"</span><span class="p">),</span> <span class="n">MB_SYSTEMMODAL</span><span class="o">|</span><span class="n">MB_OK</span><span class="o">|</span><span class="n">MB_ICONINFORMATION</span><span class="p">);</span>
<span class="cp">#endif
</span><span class="p">}</span>

<span class="c1">// TODO: Return your application main window handle
</span><span class="k">static</span> <span class="n">HWND</span> <span class="nf">myMainWnd</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp">#ifdef RHINO_SDK_CLASS
</span>  <span class="k">return</span> <span class="n">RhinoApp</span><span class="p">().</span><span class="n">MainWnd</span><span class="p">();</span>
<span class="cp">#else
</span>  <span class="k">return</span> <span class="n">AfxGetMainWnd</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">m_hWnd</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">}</span>

<span class="k">static</span> <span class="n">UINT</span> <span class="nf">myGetClipboardFormat</span><span class="p">(</span> <span class="kt">int</span> <span class="n">ver</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">UINT</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">ver</span> <span class="p">)</span>      <span class="c1">// Rhino 1.0
</span>  <span class="p">{</span>
    <span class="k">static</span> <span class="n">UINT</span> <span class="n">v1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">v1</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">v1</span> <span class="o">=</span> <span class="n">RegisterClipboardFormat</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Rhino 1.0 3DM Clip"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">ver</span> <span class="p">)</span> <span class="c1">// Rhino 2.0
</span>  <span class="p">{</span>
    <span class="k">static</span> <span class="n">UINT</span> <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">v2</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">v2</span> <span class="o">=</span> <span class="n">RegisterClipboardFormat</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Rhino 2.0 3DM Clip"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="mi">3</span> <span class="o">==</span> <span class="n">ver</span> <span class="p">)</span> <span class="c1">// Rhino 3.0
</span>  <span class="p">{</span>
    <span class="k">static</span> <span class="n">UINT</span> <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">v3</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="n">RegisterClipboardFormat</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Rhino 3.0 3DM Clip"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="mi">4</span> <span class="o">==</span> <span class="n">ver</span> <span class="p">)</span> <span class="c1">// Rhino 4.0
</span>  <span class="p">{</span>
    <span class="k">static</span> <span class="n">UINT</span> <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">v4</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="n">RegisterClipboardFormat</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"Rhino 4.0 3DM Clip global mem"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v4</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">BOOL</span> <span class="nf">myGetTempFileName</span><span class="p">(</span> <span class="n">CString</span><span class="o">&amp;</span> <span class="n">strResult</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">CString</span> <span class="n">strPath</span><span class="p">,</span> <span class="n">strFileName</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">GetTempPath</span><span class="p">(</span> <span class="n">_MAX_PATH</span><span class="p">,</span> <span class="n">strPath</span><span class="p">.</span><span class="n">GetBuffer</span><span class="p">(</span><span class="n">_MAX_PATH</span><span class="p">)</span> <span class="p">);</span>
  <span class="n">strPath</span><span class="p">.</span><span class="n">ReleaseBuffer</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="n">rc</span> <span class="o">=</span> <span class="n">GetTempFileName</span><span class="p">(</span> <span class="n">strPath</span><span class="p">,</span> <span class="n">_T</span><span class="p">(</span><span class="s">"rh$"</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">strFileName</span><span class="p">.</span><span class="n">GetBuffer</span><span class="p">(</span><span class="n">_MAX_PATH</span><span class="p">)</span> <span class="p">);</span>
  <span class="n">strFileName</span><span class="p">.</span><span class="n">ReleaseBuffer</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="n">strResult</span> <span class="o">=</span> <span class="n">strFileName</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">BOOL</span> <span class="nf">CopyClipboardToTempFile</span><span class="p">(</span> <span class="n">CString</span><span class="o">&amp;</span> <span class="n">strTempFileName</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">clipboard_format</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">IsClipboardFormatAvailable</span><span class="p">(</span><span class="n">clipboard_format</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Rhino clipboard format is not available.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">CString</span> <span class="n">strFileName</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">myGetTempFileName</span><span class="p">(</span><span class="n">strFileName</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to calculate temporary file name.</span><span class="se">\n</span><span class="s">"</span> <span class="p">));</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">OpenClipboard</span><span class="p">(</span><span class="n">myMainWnd</span><span class="p">())</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to open clipboard.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">HANDLE</span> <span class="n">hMem</span> <span class="o">=</span> <span class="n">GetClipboardData</span><span class="p">(</span> <span class="n">clipboard_format</span> <span class="p">);</span>
  <span class="k">if</span><span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">hMem</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to get clipboard data.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">CloseClipboard</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">DWORD</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ULONG</span><span class="o">*</span><span class="p">)</span><span class="n">GlobalLock</span><span class="p">(</span> <span class="n">hMem</span> <span class="p">);</span>
  <span class="k">if</span><span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">ptr</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to lock global memory block.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">CloseClipboard</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// size is encoded in the first dword
</span>  <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to determine size of clipboard memory block.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">GlobalUnlock</span><span class="p">(</span> <span class="n">hMem</span> <span class="p">);</span>
    <span class="n">CloseClipboard</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">_tfopen</span><span class="p">(</span> <span class="n">strFileName</span><span class="p">,</span> <span class="n">_T</span><span class="p">(</span><span class="s">"wb"</span><span class="p">)</span> <span class="p">);</span>

<span class="cp">#define CopyClipboardV2ToTempFile_BAIL( msg )\
{\
  GlobalUnlock( hMem );\
  CloseClipboard();\
  if( fp )\
  {\
    fclose( fp );\
    ::DeleteFile( strFileName );\
  }\
  CloseClipboard();\
  myPrintMessage( msg );\
}
</span>
  <span class="k">if</span><span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">fp</span> <span class="p">)</span>
    <span class="n">CopyClipboardV2ToTempFile_BAIL</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to open temporary file.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="n">CopyClipboardV2ToTempFile_BAIL</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to write information to temporary file.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">ferror</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">CopyClipboardV2ToTempFile_BAIL</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Error in temporary file stream.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">fflush</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">CopyClipboardV2ToTempFile_BAIL</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Error in flushing temporary file buffers.</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">CopyClipboardV2ToTempFile_BAIL</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Error in closing temporary file.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>

  <span class="n">GlobalUnlock</span><span class="p">(</span> <span class="n">hMem</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">CloseClipboard</span><span class="p">()</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DeleteFile</span><span class="p">(</span> <span class="n">strFileName</span> <span class="p">);</span>
    <span class="n">myPrintMessage</span><span class="p">(</span> <span class="n">_T</span><span class="p">(</span><span class="s">"CopyClipboardV2ToTempFile() - Unable to close the clipboard.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">strTempFileName</span> <span class="o">=</span> <span class="n">strFileName</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">BOOL</span> <span class="nf">ReadFileNameFromClipboard</span><span class="p">(</span> <span class="k">const</span> <span class="kt">wchar_t</span><span class="o">*</span> <span class="n">lpFileName</span><span class="p">,</span> <span class="n">CString</span><span class="o">&amp;</span> <span class="n">strOutputFile</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">CString</span> <span class="n">strFileName</span><span class="p">(</span> <span class="n">lpFileName</span> <span class="p">);</span>
  <span class="n">strFileName</span><span class="p">.</span><span class="n">TrimLeft</span><span class="p">();</span>
  <span class="n">strFileName</span><span class="p">.</span><span class="n">TrimRight</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">strFileName</span><span class="p">.</span><span class="n">IsEmpty</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">myGetTempFileName</span><span class="p">(</span><span class="n">strOutputFile</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">CopyFile</span><span class="p">(</span> <span class="n">strFileName</span><span class="p">,</span> <span class="n">strOutputFile</span><span class="p">,</span> <span class="nb">false</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">BOOL</span> <span class="nf">GetFileFromClipboard</span><span class="p">(</span> <span class="n">CString</span><span class="o">&amp;</span> <span class="n">strFileName</span><span class="p">,</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">file_version</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">FORMATETC</span> <span class="n">fe</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">DVASPECT_CONTENT</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">TYMED_FILE</span> <span class="p">};</span>
  <span class="n">STGMEDIUM</span> <span class="n">stgm</span><span class="p">;</span>

  <span class="n">COleDataObject</span> <span class="n">odo</span><span class="p">;</span>
  <span class="n">odo</span><span class="p">.</span><span class="n">AttachClipboard</span><span class="p">();</span>

  <span class="c1">// V4 file in clipboard
</span>  <span class="n">UINT</span> <span class="n">v4_cbformat</span> <span class="o">=</span> <span class="n">myGetClipboardFormat</span><span class="p">(</span> <span class="mi">4</span> <span class="p">);</span>
  <span class="n">fe</span><span class="p">.</span><span class="n">cfFormat</span> <span class="o">=</span> <span class="n">v4_cbformat</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">odo</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">v4_cbformat</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stgm</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fe</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">stgm</span><span class="p">.</span><span class="n">tymed</span> <span class="o">==</span> <span class="n">TYMED_FILE</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">file_version</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ReadFileNameFromClipboard</span><span class="p">(</span> <span class="n">stgm</span><span class="p">.</span><span class="n">lpszFileName</span><span class="p">,</span> <span class="n">strFileName</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// V3 file in clipboard
</span>  <span class="n">UINT</span> <span class="n">v3_cbformat</span> <span class="o">=</span> <span class="n">myGetClipboardFormat</span><span class="p">(</span> <span class="mi">3</span> <span class="p">);</span>
  <span class="n">fe</span><span class="p">.</span><span class="n">cfFormat</span> <span class="o">=</span> <span class="n">v3_cbformat</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">odo</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">v3_cbformat</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stgm</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fe</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">stgm</span><span class="p">.</span><span class="n">tymed</span> <span class="o">==</span> <span class="n">TYMED_FILE</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">file_version</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ReadFileNameFromClipboard</span><span class="p">(</span> <span class="n">stgm</span><span class="p">.</span><span class="n">lpszFileName</span><span class="p">,</span> <span class="n">strFileName</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// V1 or V2 file in clipboard
</span>  <span class="n">UINT</span> <span class="n">v1_cbformat</span> <span class="o">=</span> <span class="n">myGetClipboardFormat</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">UINT</span> <span class="n">v2_cbformat</span> <span class="o">=</span> <span class="n">myGetClipboardFormat</span><span class="p">(</span> <span class="mi">2</span> <span class="p">);</span>
  <span class="n">UINT</span> <span class="n">clipboard_format</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="o">::</span><span class="n">IsClipboardFormatAvailable</span><span class="p">(</span><span class="n">v2_cbformat</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">file_version</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">clipboard_format</span> <span class="o">=</span> <span class="n">v2_cbformat</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="o">::</span><span class="n">IsClipboardFormatAvailable</span><span class="p">(</span><span class="n">v1_cbformat</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">file_version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">clipboard_format</span> <span class="o">=</span> <span class="n">v1_cbformat</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">clipboard_format</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">CopyClipboardToTempFile</span><span class="p">(</span> <span class="n">strFileName</span><span class="p">,</span> <span class="n">clipboard_format</span> <span class="p">);</span>

  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

        </article>

      <!--</div>-->

    </div>
</div>
</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      
        <div class="row">
          <div class="col-md-4">
            <p class="text">Author: <a href="mailto:dale@mcneel.com">dale@mcneel.com</a></p>
          </div>
          <div class="col-md-4 text-center">
            
            
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <a href="https://github.com/mcneel/developer-rhino3d-com/blob/gh-pages/_guide_topics/cpp/retreiving_rhino_data_from_clipboard.md" target="_blank">Edit page on GitHub</a>
          </div>
            <div class="col-md-4">
              <span class="pull-right">
                <span class="glyphicon glyphicon-cog"></span>&nbsp;<a href="developer-rhino3d-com-branches/admin">Admin</a>
              </span>
            </div>
        </div>

        <div class="row text-center">
          © 1997 - 2016 Robert McNeel &amp; Associates
        </div>

      

    </div>

  </div>

  <script>
    if (navigator.appVersion.indexOf("Win")!=-1)
    {
      var body = document.getElementsByTagName("body");
      body[0].style.fontWeight = '400';
    }
  </script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 110
    });
    </script>
  </body>

</html>

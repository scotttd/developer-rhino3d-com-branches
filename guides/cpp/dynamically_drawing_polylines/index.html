<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Dynamically Drawing Polylines</title>
  <meta name="description" content="Dynamically Drawing Polylines">

  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/languages/vbnet.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="/css/main.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="/css/bootstrap-override.css">

  <link rel="canonical" href="http://developer.rhino3d.com/guides/cpp/dynamically_drawing_polylines/">
  <link rel="alternate" type="application/rss+xml" title="Rhino Developer Docs" href="http://developer.rhino3d.com/feed.xml" />

  <link rel="shortcut icon" href="http://developer.rhino3d.com/favicon.ico?v=2" />
  <!-- Saving bookmarks to mobile devices -->
  <!-- For non-Retina (@1× display) iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png"><!-- 57×57px -->
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/apple-touch-icon-76x76-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/apple-touch-icon-120x120-precomposed.png">
  <!-- For iPad with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">
  <!-- For iPad with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/apple-touch-icon-152x152-precomposed.png">
  <!-- For iPhone 6 Plus with @3× display: -->
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/images/apple-touch-icon-180x180-precomposed.png">
  <!-- For Chrome for Android: -->
  <link rel="icon" sizes="192x192" href="images/touch-icon-192x192.png">

</head>


  <body>

    <!-- Google Tag Manager **This belongs right after the <body> tag**-->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MWMDKN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MWMDKN');
    </script>
    <!-- End Google Tag Manager -->


    <div class="container">
      <header class="site-header">


    <a class="site-title" href="/"><img src="/images/rhinodevlogo148x128.png" alt="Rhino Developer Docs" height="48" width="56"></a><a class="site-title" href="/">Rhino Developer Docs</a>

    <nav class="site-nav">
      <img class="menu-icon" src="/images/gi.svg">
      
      <div class="trigger">
      	<!--<a class="page-link" href="/">Welcome</a>-->
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
        
          
            
              
                <a class="page-link" href="/guides/">Guides</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/api/">API</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/samples/">Samples</a>
              
            
          
        
          
            
          
        
        <a class="page-link" href="http://discourse.mcneel.com/c/rhino-developer">Forums</a>
        <!-- Google Search Engine -->
        <!-- TODO Move to this site back into the Mcneel search, or use a simple site only search for results -->
        <div id="sitesearch">
            <!-- Google CSE Search Box Begins  -->
            <!-- Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
            <!-- The terms of service are available at https://www.google.com/cse/docs/tos.html -->
            <form id="cref" action="/search-results.html">
                <input type="hidden" name="cref" value="007988927381198593803:mcq6pshqsn8" />
                <input id="searchtext" type="text" name="q" size="24" value="" placeholder="search" />
                <input class="searchBox" type="submit" name="sa" size="2" value=" " />
            </form>
        <!-- Google CSE Search Box Ends -->
        </div>
        <!--End of Google Search Engine -->
      </div>
    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <div class="container-fluid">

<div class="row-fluid">
    <!--Nav Bar -->
    <nav class="col-xs-0 col-md-3 bs-docs-sidebar">
        <ul id="sidebar" class="nav nav-stacked fixed">

          <li>
            <a href="/guides/">Guides</a>

            <ul class="nav nav-stacked">

              <li>

                
                  <a href="/guides/#cpp">C/C++</a>
                
                <ul class="nav nav-stacked">

                  <!-- Find the h1 handle for title -->
                  
                  
                  
                  
                  
                  
                  
                  <li>
                    <a href="#dynamically-drawing-polylines">Dynamically Drawing Polyl...</a>

                    <ul class="nav nav-stacked">

                      <!-- Find the h2 group and any h3 subgroups -->
                      

                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#problem">Problem</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#solution">Solution</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#sample">Sample</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#notes">Notes</a>

                          

                        </li>
                      

                    </ul>

                  </li>

                </ul>

              </li>

            </ul>

          </li>

        </ul>
    </nav>
    <!--Main Content -->
    <div class="col-xs-12 col-md-9">
      <!--<div class="post">-->

        <article class="post-content">
          <h1 id="dynamically-drawing-polylines">Dynamically Drawing Polylines</h1>

<p>This guide demonstrates how to derive a new class from CRhinoGetPoint to dynamically draw a polyline.</p>

<h2 id="problem">Problem</h2>

<p>What is the best way to draw dynamically a geometry based on a polyline?  How is it possible to compute an object geometry based on a polyline picked by the user?</p>

<h2 id="solution">Solution</h2>

<p>If you are not interested in writing your own drawing routine and you want to just use Rhino’s built-in polyline drawing tool, then you can just use Rhino’s <code class="highlighter-rouge">RhinoGetPolyline</code> function.  See <em>rhinoSdkGetLine.h</em> for more information.</p>

<p>If you need more control over how the polyline is define or how it is drawn, then you can derive your own class from <code class="highlighter-rouge">CRhinoGetPoint</code> and draw the polyline yourself.</p>

<h2 id="sample">Sample</h2>

<p>The following sample code demonstrates a simple class, derived from <code class="highlighter-rouge">CRhinoGetPoint</code>, that dynamically draws a polyline based on the points picked by a user.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">/////////////////////////////////////////////////////////////////////////////
// CRhGetPoints declaration
</span>
<span class="k">class</span> <span class="nc">CRhGetPoints</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CRhinoGetPoint</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">CRhGetPoints</span><span class="p">();</span>
  <span class="kt">void</span> <span class="n">DynamicDraw</span><span class="p">(</span> <span class="n">HDC</span> <span class="n">hdc</span><span class="p">,</span> <span class="n">CRhinoViewport</span><span class="o">&amp;</span> <span class="n">vp</span><span class="p">,</span> <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="p">);</span>
  <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">result</span> <span class="n">GetPoints</span><span class="p">(</span> <span class="n">CRhinoHistory</span><span class="o">*</span> <span class="n">history</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">bool</span> <span class="n">bOnMouseUp</span> <span class="o">=</span> <span class="nb">false</span> <span class="p">);</span>
  <span class="kt">int</span> <span class="n">Points</span><span class="p">(</span> <span class="n">ON_3dPointArray</span><span class="o">&amp;</span> <span class="n">points</span> <span class="p">);</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">ON_3dPointArray</span> <span class="n">m_P</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">/////////////////////////////////////////////////////////////////////////////
// CRhGetPoints definition
</span>
<span class="n">CRhGetPoints</span><span class="o">::</span><span class="n">CRhGetPoints</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">m_P</span><span class="p">.</span><span class="n">SetCapacity</span><span class="p">(</span> <span class="mi">64</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">CRhinoGet</span><span class="o">::</span><span class="n">result</span> <span class="n">CRhGetPoints</span><span class="o">::</span><span class="n">GetPoints</span><span class="p">(</span> <span class="n">CRhinoHistory</span><span class="o">*</span> <span class="n">history</span><span class="p">,</span> <span class="n">bool</span> <span class="n">bOnMouseUp</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">m_P</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>

  <span class="n">SetCommandPrompt</span><span class="p">(</span> <span class="s">L"First point"</span> <span class="p">);</span>

  <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">GetPoint</span><span class="p">(</span> <span class="n">history</span><span class="p">,</span> <span class="n">bOnMouseUp</span> <span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="n">res</span> <span class="o">==</span> <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">point</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">m_P</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">Point</span><span class="p">()</span> <span class="p">);</span>

    <span class="n">SetCommandPrompt</span><span class="p">(</span> <span class="s">L"Next point"</span> <span class="p">);</span>
    <span class="n">PermitOrthoSnap</span><span class="p">();</span>
    <span class="n">AcceptNothing</span><span class="p">();</span>

    <span class="k">for</span><span class="p">(</span> <span class="p">;;</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">SetBasePoint</span><span class="p">(</span> <span class="n">Point</span><span class="p">()</span> <span class="p">);</span>

      <span class="n">res</span> <span class="o">=</span> <span class="n">GetPoint</span><span class="p">(</span> <span class="n">history</span><span class="p">,</span> <span class="n">bOnMouseUp</span> <span class="p">);</span>

      <span class="k">if</span><span class="p">(</span> <span class="n">res</span> <span class="o">==</span> <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">point</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">m_P</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">Point</span><span class="p">()</span> <span class="p">);</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">res</span> <span class="o">==</span> <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">nothing</span> <span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">point</span><span class="p">;</span>

      <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">res</span> <span class="o">==</span> <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">cancel</span> <span class="p">)</span>
        <span class="n">m_P</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>

      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CRhGetPoints</span><span class="o">::</span><span class="n">DynamicDraw</span><span class="p">(</span> <span class="n">HDC</span> <span class="n">hdc</span><span class="p">,</span> <span class="n">CRhinoViewport</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">,</span> <span class="k">const</span> <span class="n">ON_3dPoint</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">m_P</span><span class="p">.</span><span class="n">Count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_P</span><span class="p">.</span><span class="n">Count</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v</span><span class="p">.</span><span class="n">DrawPoint</span><span class="p">(</span> <span class="n">m_P</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
      <span class="n">v</span><span class="p">.</span><span class="n">DrawLine</span><span class="p">(</span> <span class="n">m_P</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="n">v</span><span class="p">.</span><span class="n">DrawPoint</span><span class="p">(</span> <span class="n">m_P</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
    <span class="n">v</span><span class="p">.</span><span class="n">DrawPoint</span><span class="p">(</span> <span class="n">pt</span> <span class="p">);</span>
    <span class="n">v</span><span class="p">.</span><span class="n">DrawLine</span><span class="p">(</span> <span class="n">m_P</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="n">CRhinoGetPoint</span><span class="o">::</span><span class="n">DynamicDraw</span><span class="p">(</span> <span class="n">hdc</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">pt</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">CRhGetPoints</span><span class="o">::</span><span class="n">Points</span><span class="p">(</span> <span class="n">ON_3dPointArray</span><span class="o">&amp;</span> <span class="n">points</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">m_P</span><span class="p">.</span><span class="n">Count</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="n">points</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span> <span class="n">count</span><span class="p">,</span> <span class="n">m_P</span><span class="p">.</span><span class="n">Array</span><span class="p">()</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>You would use the above class as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">CRhinoCommand</span><span class="o">::</span><span class="n">result</span> <span class="n">CCommandTest</span><span class="o">::</span><span class="n">RunCommand</span><span class="p">(</span> <span class="k">const</span> <span class="n">CRhinoCommandContext</span><span class="o">&amp;</span> <span class="n">context</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">CRhGetPoints</span> <span class="n">gp</span><span class="p">;</span>
  <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">gp</span><span class="p">.</span><span class="n">GetPoints</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">res</span> <span class="o">==</span> <span class="n">CRhinoGet</span><span class="o">::</span><span class="n">point</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// TODO...
</span>  <span class="p">}</span>
  <span class="k">return</span> <span class="n">CRhinoCommand</span><span class="o">::</span><span class="n">success</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="notes">Notes</h2>

<p>Some additional features that would make this class better are:</p>

<ul>
  <li>The code should evaluate the distance between the current point and the previous point before adding them to the point array to ensure the points are not duplicate.</li>
  <li>The code should allow for an undo feature.</li>
  <li>After a few points have been picked, the drawing tends to flicker. This is because the entire polyline is being drawn on every mouse move. To prevent flickering, portions of the polyline that do not need to be drawn on every mouse move should drawn with a conduit.</li>
</ul>

        </article>

      <!--</div>-->

    </div>
</div>
</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      
        <div class="row">
          <div class="col-md-4">
            <p class="text">Author: <a href="mailto:dale@mcneel.com">dale@mcneel.com</a></p>
          </div>
          <div class="col-md-4 text-center">
            
            
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <a href="https://github.com/mcneel/developer-rhino3d-com/blob/gh-pages/_guide_topics/cpp/dynamically_drawing_polylines.md" target="_blank">Edit page on GitHub</a>
          </div>
            <div class="col-md-4">
              <span class="pull-right">
                <span class="glyphicon glyphicon-cog"></span>&nbsp;<a href="/admin">Admin</a>
              </span>
            </div>
        </div>

        <div class="row text-center">
          © 1997 - 2016 Robert McNeel &amp; Associates
        </div>

      

    </div>

  </div>

  <script>
    if (navigator.appVersion.indexOf("Win")!=-1)
    {
      var body = document.getElementsByTagName("body");
      body[0].style.fontWeight = '400';
    }
  </script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 110
    });
    </script>
  </body>

</html>

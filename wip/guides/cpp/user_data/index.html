<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>User Data</title>
  <meta name="description" content="User Data">

  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/github.min.css">
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/languages/vbnet.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="/developer-rhino3d-com-branches/wip/css/main.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="/developer-rhino3d-com-branches/wip/css/bootstrap-override.css">

  <link rel="canonical" href="http://mcneel.github.io/developer-rhino3d-com-branches/developer-rhino3d-com-branches/wip/guides/cpp/user_data/">
  <link rel="alternate" type="application/rss+xml" title="Rhino Developer Docs" href="http://mcneel.github.io/developer-rhino3d-com-branches/developer-rhino3d-com-branches/wip/feed.xml" />

  <link rel="shortcut icon" href="http://developer.rhino3d.com/favicon.ico?v=2" />
  <!-- Saving bookmarks to mobile devices -->
  <!-- For non-Retina (@1× display) iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-precomposed.png"><!-- 57×57px -->
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-72x72-precomposed.png">
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-76x76-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-114x114-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-120x120-precomposed.png">
  <!-- For iPad with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-144x144-precomposed.png">
  <!-- For iPad with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-152x152-precomposed.png">
  <!-- For iPhone 6 Plus with @3× display: -->
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/developer-rhino3d-com-branches/wip/images/apple-touch-icon-180x180-precomposed.png">
  <!-- For Chrome for Android: -->
  <link rel="icon" sizes="192x192" href="images/touch-icon-192x192.png">

</head>


  <body>

    <!-- Google Tag Manager **This belongs right after the <body> tag**-->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MWMDKN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MWMDKN');
    </script>
    <!-- End Google Tag Manager -->


    <div class="container">
      
<div class="version-banner">
  Hey, you're viewing the <strong>wip</strong> version of this page!
  Click <a href="/developer-rhino3d-com-branches/guides/cpp/user_data/">here</a> to view the current (stable) version.
</div>



      <header class="site-header">


    <a class="site-title" href="/developer-rhino3d-com-branches/wip/"><img src="/developer-rhino3d-com-branches/wip/images/rhinodevlogo148x128.png" alt="Rhino Developer Docs" height="48" width="56"></a><a class="site-title" href="/developer-rhino3d-com-branches/wip/">Rhino Developer Docs</a>

    <nav class="site-nav">
      <img class="menu-icon" src="/developer-rhino3d-com-branches/wip/images/gi.svg">
      
      <div class="trigger">
      	<!--<a class="page-link" href="/developer-rhino3d-com-branches/wip/">Welcome</a>-->
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
            
              
            
          
        
          
        
          
            
              
                <a class="page-link" href="/developer-rhino3d-com-branches/wip/guides/">Guides</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/developer-rhino3d-com-branches/wip/api/">API</a>
              
            
          
        
          
            
              
                <a class="page-link" href="/developer-rhino3d-com-branches/wip/samples/">Samples</a>
              
            
          
        
          
            
          
        
        <a class="page-link" href="http://discourse.mcneel.com/c/rhino-developer">Forums</a>
        <!-- Google Search Engine -->
        <!-- TODO Move to this site back into the Mcneel search, or use a simple site only search for results -->
        <div id="sitesearch">
            <!-- Google CSE Search Box Begins  -->
            <!-- Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
            <!-- The terms of service are available at https://www.google.com/cse/docs/tos.html -->
            <form id="cref" action="/developer-rhino3d-com-branches/wip/search-results.html">
                <input type="hidden" name="cref" value="007988927381198593803:mcq6pshqsn8" />
                <input id="searchtext" type="text" name="q" size="24" value="" placeholder="search" />
                <input class="searchBox" type="submit" name="sa" size="2" value=" " />
            </form>
        <!-- Google CSE Search Box Ends -->
        </div>
        <!--End of Google Search Engine -->
      </div>
    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <div class="container-fluid">

<div class="row-fluid">
    <!--Nav Bar -->
    <nav class="col-xs-0 col-md-3 bs-docs-sidebar">
        <ul id="sidebar" class="nav nav-stacked fixed">

          <li>
            <a href="/developer-rhino3d-com-branches/wip/guides/">Guides</a>

            <ul class="nav nav-stacked">

              <li>

                
                  <a href="/developer-rhino3d-com-branches/wip/guides/#cpp">C/C++</a>
                
                <ul class="nav nav-stacked">

                  <!-- Find the h1 handle for title -->
                  
                  
                  
                  
                  
                  
                  
                  <li>
                    <a href="#user-data">User Data</a>

                    <ul class="nav nav-stacked">

                      <!-- Find the h2 group and any h3 subgroups -->
                      

                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#overview">Overview</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#document-user-data">Document User Data</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#object-user-data">Object User Data</a>

                          
                            <ul class="nav nav-stacked">
                              

                              
                                
                                
                                
                                
                                
                                <li>
                                    <a href="#attaching-object-user-data-to-crhinoobjects">Attaching Object User Dat...</a>
                                </li>
                              

                            </ul>
                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#samples">Samples</a>

                          
                            <ul class="nav nav-stacked">
                              

                              
                                
                                
                                
                                
                                
                                <li>
                                    <a href="#cmyuserdata1">CMyUserData1</a>
                                </li>
                              
                                
                                
                                
                                
                                
                                <li>
                                    <a href="#cmyuserdata2">CMyUserData2</a>
                                </li>
                              

                            </ul>
                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#user-data-operator-and-copy-construction">User Data operator= and C...</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#sharing-user-data-between-plugins">Sharing User Data Between...</a>

                          

                        </li>
                      
                        
                        
                        
                        
                        
                        <li>
                          <a href="#related-topics">Related Topics</a>

                          

                        </li>
                      

                    </ul>

                  </li>

                </ul>

              </li>

            </ul>

          </li>

        </ul>
    </nav>
    <!--Main Content -->
    <div class="col-xs-12 col-md-9">
      <!--<div class="post">-->

        <article class="post-content">
          <h1 id="user-data">User Data</h1>

<p>This guide covers user data using C/C++.</p>

<h2 id="overview">Overview</h2>

<p>There are two basic ways plugins can store information in Rhino <em>.3dm</em> files:</p>

<ol>
  <li><em>Document User Data</em></li>
  <li><em>Object User Data</em></li>
</ol>

<p>For example, a rendering plugin might save a scene description as <em>Document User Data</em> and use <em>Object User Data</em> to attach rendering material information to individual surfaces.</p>

<h2 id="document-user-data">Document User Data</h2>

<p>To save document user data your plugin must override three <code class="highlighter-rouge">CRhinoPlugIn</code> base class functions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">CRhinoPlugIn</span><span class="o">::</span><span class="n">CallWriteDocument</span>
<span class="n">CRhinoPlugIn</span><span class="o">::</span><span class="n">WriteDocument</span>
<span class="n">CRhinoPlugIn</span><span class="o">::</span><span class="n">ReadDocument</span>
</code></pre>
</div>

<p>When Rhino writes a <em>.3dm</em> file, it goes through all the plugins that are currently loaded.  First Rhino calls <code class="highlighter-rouge">CallWriteDocument()</code> to see if the plugin wants to save document user data.  If <code class="highlighter-rouge">CallWriteDocument()</code> returns <code class="highlighter-rouge">true</code>, Rhino saves information that identifies the plugin and then calls <code class="highlighter-rouge">WriteDocument()</code> when it is time for the plugin to save its document user data.</p>

<p>When Rhino reads a <em>.3dm</em> file and it encounters document user data, it uses the plugin identification information to load the plugin and then calls the plugin’s <code class="highlighter-rouge">ReadDocument()</code> to read the plugin’s document user data.</p>

<h2 id="object-user-data">Object User Data</h2>

<p>Object user data can be attached to things like layers, materials, geometry objects, and object attributes.  In fact object user data can be attached to any class derived from <code class="highlighter-rouge">ON_Object</code>.  This user data is stored in a linked list on <code class="highlighter-rouge">ON_Object</code> and can be copied, transformed, and saved along with the parent object.  For example, you could attach object user data to a mesh.  When the mesh is copied the object user data is copied and attached to the copy.  When the mesh is transformed, the transformation is recorded by the object user data.  When the mesh is saved in a <em>.3dm</em> file, the object user data is saved too.</p>

<p>All object user data is saved in a class you write that is derived from the class <code class="highlighter-rouge">ON_UserData</code>.</p>

<h3 id="attaching-object-user-data-to-crhinoobjects">Attaching Object User Data to CRhinoObjects</h3>

<p>The Rhino geometry table is where the bulk of the Rhino model is stored.  This is where the points, curves, meshes, surface, polysurfaces, annotation, render lights, and so on are stored.  Each member of the geometry table is derived from the <code class="highlighter-rouge">CRhinoObject</code> class.  There are three places you can attach object user data to a <code class="highlighter-rouge">CRhinoObject</code>:</p>

<ol>
  <li>The <code class="highlighter-rouge">CRhinoObject</code> geometry class</li>
  <li>The <code class="highlighter-rouge">CRhinoObject</code> attributes class, and</li>
  <li>The <code class="highlighter-rouge">CRhinoObject</code> itself.</li>
</ol>

<p>Object user data attached to the geometry and attributes class persists through copys, transformations, and file IO.  Object user data attached directly on the <code class="highlighter-rouge">CRhinoObject</code> class is never saved in <em>.3dm</em> file.</p>

<p>To attach object user data to the <code class="highlighter-rouge">CRhinoObject</code> geometry use <code class="highlighter-rouge">CRhinoObject::AttachGeometryUserData()</code>.  This call attaches the user data to the <code class="highlighter-rouge">CRhinoObject.m_geometry</code> member.  This user data will persist when the object is copied, transformed, or saved in <em>.3dm</em> files.</p>

<p>To attach object user data to the <code class="highlighter-rouge">CRhinoObject</code> attributes, use <code class="highlighter-rouge">CRhinoObject::AttachAttributeUserData()</code>.  This call attaches the user data to the <code class="highlighter-rouge">CRhinoObject.m_attributes</code> member.  This user data will persist when the object is copied, transformed, or saved in <em>.3dm</em> files.</p>

<p>To attach object user data to the <code class="highlighter-rouge">CRhinoObject</code> itself, use <code class="highlighter-rouge">CRhinoObject::AttachUserData()</code>.  This user data is attached to the <code class="highlighter-rouge">CRhinoObject</code> class itself and will never be saved in <em>.3dm</em> files.  It is a good place to attach runtime information that applies only to the specific class it is attached to.  In general, object user data attached directly to a <code class="highlighter-rouge">CRhinoObject</code> class will have <code class="highlighter-rouge">m_userdata_copycount = 0</code> and will have an <code class="highlighter-rouge">Archive()</code> function that returns <code class="highlighter-rouge">false</code>.</p>

<h2 id="samples">Samples</h2>

<p>The first sample, <em>CMyUserData1</em>, shows how to make a simple piece of user data that is not saved in <em>.3dm</em> files.  The second sample, <em>CMyUserData2</em>, shows how to make a piece of user data that is saved in <em>.3dm</em> files.</p>

<p>You can download the source for the next two samples here: <a href="/developer-rhino3d-com-branches/wip/files/myuserdataexample.zip"><span class="glyphicon glyphicon-download"></span></a> <a href="/developer-rhino3d-com-branches/wip/files/myuserdataexample.zip">mcneelcodesigning.zip</a></p>

<h3 id="cmyuserdata1">CMyUserData1</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CMyUserData1</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ON_UserData</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

  <span class="cm">/*
  Returns:
   Uuid used to identify this type of user data.
   This is the value saved in m_userdata_uuid and
   passed to ON_Object::GetUserData().
  */</span>
  <span class="k">static</span> <span class="n">ON_UUID</span> <span class="n">Id</span><span class="p">();</span>

  <span class="n">CMyUserData1</span><span class="p">();</span>
  <span class="o">~</span><span class="n">CMyUserData1</span><span class="p">();</span>

  <span class="c1">//... download example for more details
</span>
  <span class="n">ON_wString</span> <span class="n">m_my_string</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">CMyUserData1</code> class must always be on the heap (constructed by calling the C/C++ new operator).  The class’s constructor must initialize two <code class="highlighter-rouge">ON_UserData</code> fields, <code class="highlighter-rouge">m_userdata_uuid</code>, <code class="highlighter-rouge">m_application_uuid</code>.  In addition, if you want the object user data copied whenever its parent object is copied, you have to set <code class="highlighter-rouge">m_userdata_copycount</code> to one…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">ON_UUID</span> <span class="n">CMyUserData1</span><span class="o">::</span><span class="n">Id</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Use Microsoft's guidgen to get a unique id.
</span>  <span class="c1">// {1129B130-B840-...}
</span>  <span class="k">static</span> <span class="k">const</span> <span class="n">ON_UUID</span> <span class="n">id</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x1129b130</span><span class="p">,</span> <span class="mh">0xb840</span><span class="p">,</span> <span class="p">...</span> <span class="p">};</span>
  <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">CMyUserData1</span><span class="o">::</span><span class="n">CMyUserData1</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">m_userdata_uuid</span> <span class="o">=</span> <span class="n">CMyUserData1</span><span class="o">::</span><span class="n">Id</span><span class="p">();</span>
  <span class="n">m_application_uuid</span> <span class="o">=</span> <span class="n">MyPlugIn</span><span class="p">().</span><span class="n">PlugInID</span><span class="p">();</span>
  <span class="n">m_userdata_copycount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">enable</span> <span class="n">copying</span>
<span class="p">}</span>

<span class="c1">// ... download example for more details
</span></code></pre>
</div>

<p>Attaching object user data to a parent object is a simple matter…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">ON_Mesh</span><span class="o">*</span> <span class="n">pMesh</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">CMyUserData1</span><span class="o">*</span> <span class="n">pMyUserData1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CMyUserData1</span><span class="p">();</span>
<span class="n">pMyUserData1</span><span class="o">-&gt;</span><span class="n">m_my_string</span> <span class="o">=</span> <span class="s">L"How, now, brown cow?"</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">pMesh</span><span class="o">-&gt;</span><span class="n">AttachUserData</span><span class="p">(</span><span class="n">pMyUserData1</span><span class="p">)</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// It worked.  The mesh class will manage the user
</span>  <span class="c1">// data and delete it at the appropriate time.
</span>  <span class="n">RhinoApp</span><span class="p">().</span><span class="n">Print</span><span class="p">(</span><span class="s">"User data attached.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="o">:</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="c1">// It didn't work.  This usually means that
</span>  <span class="c1">// the parent object already has this kind
</span>  <span class="c1">// of user data attached.
</span>  <span class="n">RhinoApp</span><span class="p">().</span><span class="n">Print</span><span class="p">(</span><span class="s">"User data not attached.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">pMyUserData</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">pMyUserData</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre>
</div>

<p>The user data’s <em>UUID</em> is used to retrieve the user data from a parent object…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">ON_Mesh</span><span class="o">*</span> <span class="n">pMesh</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">ON_UserData1</span><span class="o">*</span> <span class="n">pUserData</span> <span class="o">=</span> <span class="n">pMesh</span><span class="o">-&gt;</span><span class="n">GetUserData</span><span class="p">(</span><span class="n">CMyUserData1</span><span class="o">::</span><span class="n">Id</span><span class="p">());</span>
<span class="n">CMyUserData1</span><span class="o">**</span> <span class="n">pMyUserData1</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CMyUserData1</span><span class="o">**&gt;</span><span class="p">(</span><span class="n">pUserData</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">pMyUserData1</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">RhinoApp</span><span class="p">().</span><span class="n">Print</span><span class="p">(</span><span class="s">"Got user data.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="o">:</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="n">RhinoApp</span><span class="p">().</span><span class="n">Print</span><span class="p">(</span><span class="s">"My user data is not on the mesh.</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span><span class="o">:</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="cmyuserdata2">CMyUserData2</h3>

<p>Make sure you completely understand the <em>CMyUserData1</em> sample above before studying this sample.</p>

<p>To have your user data saved in files, you have to add several IO related functions and add full openNURBS object support to your class…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CMyUserData2</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ON_UserData</span>
<span class="p">{</span>
  <span class="c1">// openNURBS classes that are saved in .3dm files require
</span>  <span class="c1">// an ON_OBJECT_DECLARE call in their declaration.
</span>  <span class="n">ON_OBJECT_DECLARE</span><span class="p">(</span><span class="n">CMyUserData2</span><span class="p">);</span>

<span class="k">public</span><span class="o">:</span>

 <span class="k">static</span> <span class="n">ON_UUID</span> <span class="n">Id</span><span class="p">();</span>

 <span class="n">CMyUserData2</span><span class="p">();</span>
 <span class="o">~</span><span class="n">CMyUserData2</span><span class="p">();</span>

  <span class="c1">// override virtual ON_UserData::Archive()
</span>  <span class="n">BOOL</span> <span class="n">Archive</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

  <span class="c1">// override virtual ON_UserData::Write()
</span>  <span class="n">BOOL</span> <span class="n">Write</span><span class="p">(</span><span class="n">ON_BinaryArchive</span><span class="o">&amp;</span> <span class="n">binary_archive</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

  <span class="c1">// override virtual ON_UserData::Read()
</span>  <span class="n">BOOL</span> <span class="n">Read</span><span class="p">(</span><span class="n">ON_BinaryArchive</span><span class="o">&amp;</span> <span class="n">binary_archive</span><span class="p">);</span>

  <span class="c1">// ... download example for more details
</span>
 <span class="n">ON_wString</span> <span class="n">m_my_string</span><span class="p">;</span>
 <span class="n">ON_3dPoint</span> <span class="n">m_my_point</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>

<p>Again, the <code class="highlighter-rouge">CMyUserData2</code> class must always be on the heap (constructed by calling the C/C++ new operator).  To support file IO, the definition of <code class="highlighter-rouge">CMyUserData2</code> must contain the <code class="highlighter-rouge">ON_OBJECT_DECLARE</code> macro.</p>

<p>The cpp file where the class is implemented must contain the <code class="highlighter-rouge">ON_OBJECT_IMPLEMENT</code> macro shown here:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">ON_OBJECT_IMPLEMENT</span><span class="p">(</span><span class="n">CMyUserData2</span><span class="p">,</span><span class="n">ON_UserData</span><span class="p">,</span><span class="s">"0D8FA7AB-F8A4-..."</span><span class="p">);</span>
</code></pre>
</div>

<p>The construction code for <code class="highlighter-rouge">CMyUserData2</code> looks like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">ON_UUID</span> <span class="n">CMyUserData2</span><span class="o">::</span><span class="n">Id</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">CMyUserData2</span><span class="o">::</span><span class="n">m_CMyUserData2_class_id</span><span class="p">.</span><span class="n">Uuid</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">CMyUserData2</span><span class="o">::</span><span class="n">CMyUserData2</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">m_userdata_uuid</span> <span class="o">=</span> <span class="n">CMyUserData2</span><span class="o">::</span><span class="n">Id</span><span class="p">();</span>
  <span class="n">m_application_uuid</span> <span class="o">=</span> <span class="n">MyPlugIn</span><span class="p">().</span><span class="n">PlugInID</span><span class="p">();</span>
  <span class="n">m_userdata_copycount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// enable copying
</span>
  <span class="c1">// initialize your data members here
</span>  <span class="n">m_my_point</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">CMyUserData2::Archive()</code>, <code class="highlighter-rouge">CMyUserData2::Read()</code>, <code class="highlighter-rouge">CMyUserData2::Write()</code> functions look something like this…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">BOOL</span> <span class="n">CMyUserData2</span><span class="o">::</span><span class="n">Archive</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="c1">// If false is returned, nothing will be saved in 3dm archives.
</span>  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOL</span> <span class="n">CMyUserData2</span><span class="o">::</span><span class="n">Write</span><span class="p">(</span><span class="n">ON_BinaryArchive</span><span class="o">&amp;</span> <span class="n">binary_archive</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="c1">// ... download example for more details about adding version support
</span>
  <span class="kt">int</span> <span class="n">minor_version</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">binary_archive</span><span class="p">.</span><span class="n">BeginWrite3dmChunk</span><span class="p">(</span>
       <span class="n">TCODE_ANONYMOUS_CHUNK</span><span class="p">,</span>
       <span class="mi">1</span><span class="p">,</span>
       <span class="n">minor_version</span>
       <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="c1">// Write class members like this
</span>  <span class="k">for</span> <span class="p">(;;)</span>
  <span class="p">{</span>
    <span class="c1">// version 1.0 fields
</span>    <span class="n">rc</span> <span class="o">=</span> <span class="n">binary_archive</span><span class="p">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">m_my_string</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">binary_archive</span><span class="p">.</span><span class="n">WritePoint</span><span class="p">(</span><span class="n">m_my_point</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">binary_archive</span><span class="p">.</span><span class="n">EndWrite3dmChunk</span><span class="p">()</span> <span class="p">)</span>
   <span class="n">rc</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">BOOL</span> <span class="n">CMyUserData2</span><span class="o">::</span><span class="n">Read</span><span class="p">(</span><span class="n">ON_BinaryArchive</span><span class="o">&amp;</span> <span class="n">binary_archive</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ... download example for more details about adding version support
</span>
  <span class="kt">int</span> <span class="n">major_version</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">minor_version</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">binary_archive</span><span class="p">.</span><span class="n">BeginRead3dmChunk</span><span class="p">(</span>
         <span class="n">TCODE_ANONYMOUS_CHUNK</span><span class="p">,</span>
         <span class="o">&amp;</span><span class="n">major_version</span><span class="p">,</span>
         <span class="o">&amp;</span><span class="n">minor_version</span>
         <span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="c1">// Read class members like this
</span>  <span class="k">for</span> <span class="p">(;;)</span>
  <span class="p">{</span>
    <span class="n">rc</span> <span class="o">==</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">major_version</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

    <span class="c1">// version 1.0 fields
</span>    <span class="n">rc</span> <span class="o">=</span> <span class="n">binary_archive</span><span class="p">.</span><span class="n">ReadString</span><span class="p">(</span><span class="n">m_my_string</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">binary_archive</span><span class="p">.</span><span class="n">ReadPoint</span><span class="p">(</span><span class="n">m_my_point</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// If BeginRead3dmChunk() returns true,
</span>  <span class="c1">// then EndRead3dmChunk() must be called,
</span>  <span class="c1">// even if a read operation failed.
</span>  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">binary_archive</span><span class="p">.</span><span class="n">EndRead3dmChunk</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

 <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="user-data-operator-and-copy-construction">User Data operator= and Copy Construction</h2>

<p>In general, you do not need to explicitly override the default copy constructor and <code class="highlighter-rouge">operator=</code> that C/C++ generates for you.  Incorrectly implemented copy constructors and <code class="highlighter-rouge">operator=</code>s are a common source of bugs.  The C/C++ defaults will work perfectly if every member of your class is a built-in data type (<code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">double</code>, …) or a class that properly handles copy construction and <code class="highlighter-rouge">operator=</code> (<code class="highlighter-rouge">ON_NurbsCurve</code>, <code class="highlighter-rouge">ON_3dPoint</code>, <code class="highlighter-rouge">ON_Simple</code>/<code class="highlighter-rouge">ClassArray&lt;&gt;</code>, …).</p>

<p>The main reason you have to explicitly implement a copy constructor and <code class="highlighter-rouge">operator=</code> is to handle fields that involve explicit heap allocation and deallocation.  In the sample below, the field <code class="highlighter-rouge">m_i_array</code> is an array of integers that is on the heap.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CMyUserData3</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ON_UserData</span>
<span class="p">{</span>
  <span class="n">ON_OBJECT_DECLARE</span><span class="p">(</span><span class="n">CMyUserData3</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">ON_UUID</span> <span class="n">Id</span><span class="p">();</span>
  <span class="k">static</span> <span class="n">ON_UUID</span> <span class="n">ApplicationId</span><span class="p">();</span>
  <span class="k">static</span> <span class="n">CMyUserData3</span><span class="o">**</span> <span class="n">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">ON_Object</span><span class="o">**</span><span class="p">);</span>

  <span class="n">CMyUserData3</span><span class="p">();</span>
  <span class="o">~</span><span class="n">CMyUserData3</span><span class="p">();</span>
  <span class="n">CMyUserData3</span><span class="p">(</span><span class="k">const</span> <span class="n">CMyUserData3</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">);</span>
  <span class="n">CMyUserData3</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">CMyUserData3</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">);</span>

  <span class="c1">//...
</span>
  <span class="kt">int</span> <span class="n">m_i_count</span><span class="p">;</span>
  <span class="kt">int</span><span class="o">*</span> <span class="n">m_i_array</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">ON_OBJECT_IMPLEMENT</span><span class="p">(</span><span class="n">CMyUserData3</span><span class="p">,</span>
                    <span class="n">ON_UserData</span><span class="p">,</span>
                    <span class="o">&lt;&lt;</span><span class="n">guidgen</span> <span class="n">generated</span> <span class="n">uuid</span> <span class="n">here</span><span class="o">&gt;&gt;</span>
                    <span class="p">);</span>

<span class="n">ON_UUID</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">Id</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">m_CMyUserData3_class_id</span><span class="p">.</span><span class="n">Uuid</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">ON_UUID</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">ApplicationId</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;&lt;</span><span class="n">your</span> <span class="n">plugin</span> <span class="n">name</span><span class="o">&gt;&gt;</span><span class="p">().</span><span class="n">PlugInID</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">CMyUserData3</span><span class="o">**</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">Get</span><span class="p">(</span><span class="k">const</span> <span class="n">ON_Object</span><span class="o">**</span> <span class="n">object</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">Cast</span><span class="p">(</span> <span class="p">(</span><span class="n">object</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                             <span class="o">?</span> <span class="n">object</span><span class="o">-&gt;</span><span class="n">GetUserData</span><span class="p">(</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">Id</span><span class="p">()</span> <span class="p">)</span>
                          <span class="p">);</span>
<span class="p">}</span>

<span class="n">CMyUserData3</span><span class="o">::</span><span class="n">CMyUserData3</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">m_userdata_uuid</span> <span class="o">=</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">Id</span><span class="p">();</span>
  <span class="n">m_application_uuid</span> <span class="o">=</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">ApplicationId</span><span class="p">();</span>
  <span class="n">m_userdata_copycount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// Initialize your class's fields
</span>  <span class="n">m_i_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">m_i_array</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">CMyUserData3</span><span class="o">::~</span><span class="n">CMyUserData3</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// virtual function
</span>  <span class="k">if</span> <span class="p">(</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">m_i_array</span> <span class="p">)</span>
    <span class="n">onfree</span><span class="p">(</span><span class="n">m_i_array</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>When the copy constructor is called, the memory for “this” is not initialized.  You must call the base class copy constructor, initialize all your class’s fields, and then copy your class’s fields…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">CMyUserData3</span><span class="o">::</span><span class="n">CMyUserData3</span><span class="p">(</span><span class="k">const</span> <span class="n">CMyUserData3</span><span class="o">&amp;</span> <span class="n">src</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">m_userdata_uuid</span> <span class="o">=</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">Id</span><span class="p">();</span>
  <span class="n">m_application_uuid</span> <span class="o">=</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="n">ApplicationId</span><span class="p">();</span>
  <span class="n">m_transform_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// DO NOT SET OTHER ON_UserData fields
</span>  <span class="c1">// In particular, do not set m_userdata_copycount
</span>
  <span class="n">Copy</span> <span class="n">you</span> <span class="k">class</span><span class="err">'</span><span class="nc">s</span> <span class="n">fields</span>
  <span class="n">m_i_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">m_i_array</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">src</span><span class="p">.</span><span class="n">m_i_array</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">m_i_array</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">**</span><span class="p">)</span><span class="n">onmalloc</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span><span class="o">**</span><span class="k">sizeof</span><span class="p">(</span><span class="n">m_i_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">m_i_array</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">memcpy</span><span class="p">(</span> <span class="n">m_i_array</span><span class="p">,</span>
              <span class="n">src</span><span class="p">.</span><span class="n">m_i_array</span><span class="p">,</span>
              <span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">m_i_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
           <span class="p">);</span>
      <span class="n">m_i_count</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>When <code class="highlighter-rouge">operator=</code> is called, “this” has already been constructed and may already have been used.  You must destroy any existing information, call the the base class <code class="highlighter-rouge">operator=</code>, and then copy your class’s fields…</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">CMyUserData3</span><span class="o">&amp;</span> <span class="n">CMyUserData3</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">CMyUserData3</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="k">this</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">src</span> <span class="p">)</span>
  <span class="p">{</span>
   <span class="c1">// Destroy your class's existing information
</span>   <span class="c1">// (Otherwise you will leak memory if "this"
</span>   <span class="c1">// has been used before.)
</span>   <span class="n">m_i_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span> <span class="n">m_i_array</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
   <span class="p">{</span>
     <span class="n">onfree</span><span class="p">(</span><span class="n">m_i_array</span><span class="p">);</span>
     <span class="n">m_i_array</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="p">}</span>

   <span class="c1">// Use the base class operator=() to correctly
</span>   <span class="c1">// copy all ON_UserData fields.
</span>   <span class="n">ON_UserData</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>

   <span class="c1">// Copy your class's fields
</span>   <span class="k">if</span><span class="p">(</span> <span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">src</span><span class="p">.</span><span class="n">m_i_array</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
   <span class="p">{</span>
     <span class="n">m_i_array</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">**</span><span class="p">)</span><span class="n">onmalloc</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span><span class="o">**</span><span class="k">sizeof</span><span class="p">(</span><span class="n">m_i_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
     <span class="k">if</span> <span class="p">(</span> <span class="n">m_i_array</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
     <span class="p">{</span>
       <span class="n">memcpy</span><span class="p">(</span> <span class="n">m_i_array</span><span class="p">,</span>
               <span class="n">src</span><span class="p">.</span><span class="n">m_i_array</span><span class="p">,</span>
               <span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">m_i_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
             <span class="p">);</span>
       <span class="n">m_i_count</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">m_i_count</span><span class="p">;</span>
     <span class="p">}</span>
   <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="sharing-user-data-between-plugins">Sharing User Data Between Plugins</h2>

<p>The best way to share user data between plugins is to have access to the plugins data controlled by a shared <em>DLL</em> - a <em>DLL</em> that is used by all interested plugins.  The user data class definitions and declarations, along with any helper functions used to access this data, are then added to and exported from this <em>DLL</em>.</p>

<p>The easiest way to make <em>DLLs</em> for Rhino plugins is to simply run the <em>Rhino Plugin Wizard</em> from Visual Studio.  When the wizard finishes, simply delete the plugins object (<em>cpp</em> and <em>h</em> files) and the command file.  Then change the output file extension from <em>rhp</em> to <em>dll</em>.  Now, you have a <em>MFC DLL</em> that links with the Rhino C/C++ SDK.</p>

<p>One important piece of information to keep in mind is that when you create a class derived from <code class="highlighter-rouge">ON_UserData</code> and you expect this data to be serialized in a <em>3dm</em> file, then you must assign the owning plugins’s <em>UUID</em> to the <code class="highlighter-rouge">ON_UserData::m_application_uuid</code> data member.  This is how Rhino knows what plugins to load when it encounters plugin user data when reading a <em>3dm</em> file.  Note, it is not important what plugins’s <em>UUID</em> is assigned to the user data because all of the plugins are going to dynamically load the <em>DLL</em> when they are loaded anyway.  But, some plugin must be “in charge.”</p>

<p>For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">ON_UUID</span> <span class="n">CPlugInUserData</span><span class="o">::</span><span class="n">PlugInId</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Copied from PlugIn1PlugIn.cpp
</span>
  <span class="c1">// {F8B054CD-19A3-4D46-AB7E-DB3E8EF8CF5B}
</span>  <span class="k">static</span> <span class="k">const</span> <span class="n">GUID</span> <span class="n">PlugIn1PlugIn_UUID</span> <span class="o">=</span>
  <span class="p">{</span> <span class="mh">0xF8B054CD</span><span class="p">,</span> <span class="mh">0x19A3</span><span class="p">,</span> <span class="mh">0x4D46</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x7E</span><span class="p">,</span> <span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x5B</span> <span class="p">}</span> <span class="p">};</span>
  <span class="k">return</span> <span class="n">PlugIn1PlugIn_UUID</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">CPlugInUserData</span><span class="o">::</span><span class="n">CPlugInUserData</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">m_userdata_uuid</span> <span class="o">=</span> <span class="n">CPlugInUserData</span><span class="o">::</span><span class="n">Id</span><span class="p">();</span>

  <span class="cm">/*
  CRITICAL:
    m_application_uuid must be assigned the uuid of the plugin
    that will be responsible for reading and writing our user data.
    In this example, we'll use PlugIn1 as our primary plugin.
  */</span>
  <span class="n">m_application_uuid</span> <span class="o">=</span> <span class="n">CPlugInUserData</span><span class="o">::</span><span class="n">PlugInId</span><span class="p">();</span>

  <span class="n">m_userdata_copycount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// enable copying
</span>
  <span class="c1">// initialize your data members here
</span>  <span class="n">m_point</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">);</span>
  <span class="n">m_string</span> <span class="o">=</span> <span class="n">L</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>This plugin sample contains two plugin projects and one <em>DLL</em> project:</p>

<p><a href="/developer-rhino3d-com-branches/wip/files/testshareduserdata.zip"><span class="glyphicon glyphicon-download"></span></a> <a href="/developer-rhino3d-com-branches/wip/files/testshareduserdata.zip">testshareduserdata.zip</a></p>

<p>To load the sample, just download and extract into some folder, and then open <em>Test.sln</em> is Visual Studio.</p>

<h2 id="related-topics">Related Topics</h2>

<ul>
  <li><a href="/developer-rhino3d-com-branches/wip/samples/cpp/attaching_user_data_to_brep_components">Attaching User Data to Brep Components</a></li>
</ul>

        </article>

      <!--</div>-->

    </div>
</div>
</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      
        <div class="row">
          <div class="col-md-4">
            <p class="text">Author: <a href="mailto:dale@mcneel.com">dale@mcneel.com</a></p>
          </div>
          <div class="col-md-4 text-center">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <a href="https://github.com/mcneel/developer-rhino3d-com-branches/blob/wip/_guide_topics/cpp/user_data.md" target="_blank">Edit page on GitHub</a>
          </div>
            <div class="col-md-4">
              <span class="pull-right">
                <span class="glyphicon glyphicon-cog"></span>&nbsp;<a href="/developer-rhino3d-com-branches/wip/admin">Admin</a>
              </span>
            </div>
        </div>

        <div class="row text-center">
          © 1997 - 2016 Robert McNeel &amp; Associates
        </div>

      

    </div>

  </div>

  <script>
    if (navigator.appVersion.indexOf("Win")!=-1)
    {
      var body = document.getElementsByTagName("body");
      body[0].style.fontWeight = '400';
    }
  </script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 150 /* fixed header is about 40px high */
    });
    </script>
  </body>

</html>
